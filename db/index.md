### 索结结构（方法）

 **Hash索引** ：对于每一行数据，存储引擎都会对所有的索引列的值计算一个哈希码存储在哈希表中。哈希索引只包含哈希值和行指针（指向实际的行数据），当有哈希冲突时，则会逐行比较符合查询条件的数据行。

 -  **优点** ：如果是等值查询，则效率非常高，时间复杂度为O(1)，例如：查询某个列等于某个值的时候，只需要计算这个列的hash码，就能快速定位到这行数据，效率当然很高。
 -  **缺点**：Hash索引的缺点也很明细，只支持等值比较查询如：=，in(),<=>(严格比较两个NULL值是否相等,两个操作码均为NULL时，其所得值为1；而当一个操作码为NULL时，其所得值为0)，不支持任何范围查询，因为它是计算索引列的哈希码存储的，范围查找就失去了意义，而且无法用于排序，同时它也不支持部分索引列匹配查找，比如多个索引列，只匹配其中的部分列是做不到的，因为它是将所有的索引列计算出一个哈希码。哈希索引只包含哈希值和行指针，所以不能使用覆盖索引。

总的来说，Hash索引只适合特定的场景，它的限制极多。

**BTree索引**：mysql中称为B+树索引（查看表的索引时，显示的索引类型是BTree，实际实现的是B+树），在介绍B+树之前先介绍一下B树（B树、BTree、B-Tree都是同一个概念，都称为BTree），B树是一种多路自平衡搜索树，它类似普通的二叉树，但是B树允许每个节点有更多的子节点（二叉树一个节点下最多两个节点，而B树下一个节点可以有超过两个的节点），特点是：

- 所有节点中即包含记录的索引key值和这条记录的所有数据，以及指向下一个节点的指针；
- 任何一条记录出现且只出现在一个节点中；
- 搜索可能在非叶子节点时就结束了（因为节点中包含这条记录的所有数据，查到某条记录可以直接返回）；

以下为BTree的结构图：
![输入图片说明](image.png)

B+树是对B树的升级，非叶子节点只存储索引列和下一个节点的指针（不再存储数据了），叶子节点存储索引列和数据以及下一个节点的指针（叶子节点是相连的），以现实中的树木比喻说明就是，BTree更加繁茂，而B+树相对精简，以下为B+树的结构图：

![输入图片说明](../image.png)

那么为什么不用BTree而是用的B+树呢？见下面的问题。

参考：[一文看懂B TREE和B+TREE数据结构实现过程及数据存储结构](https://blog.csdn.net/qq_28721869/article/details/115803481)

### 为什么采用 B+树

为什么采用的是B+树，而不是B树或者平衡二叉树或者是红黑树
 
**B+树相对于B树：** 
- B+树非叶子节点只存储索引键和指针，相对B树来讲可以存储更多的索引键，这样的话B+树的深度也会更低，一次性读入内存的索引键也会更多，IO的次数也会变少，查询效率更高
- B+树的所有数据都存储在叶子节点上，如果要取数据的话，那么每次查询IO的次数都是相同的，也就是说查询是稳定的
- B+树叶子节点之间通过双向链表连接，可以很方便的进行范围查询
总结就是B+树比B树查询效果更高更稳定，而且方便范围查询。

 **B+树相对于平衡二叉树或红黑树：** 
- 平衡二叉树追求绝对平衡，条件比较苛刻，而红黑树是对平衡二叉树的弱实现，追求大致平衡，在与平衡二叉树的时间复杂度相差不大的情况下，保证每次插入最多只需要三次旋转就能达到平衡，实现起来也更为简单，然而不管是平衡二叉树还是红黑树它们的任一节点最多有两个子节点，假设使用平衡二叉树或红黑树作为索引结构，那么一个节点只能存储一个索引键和指针，在数据量非常大的情况下，平衡二叉树或红黑树的深度会变的更深，这就意味着查询需要更多的IO，这显然不能被接受。

### 索引原理

这里主要介绍以B+树实现索引的原理。上面关于B+树的介绍中，多次提到磁盘IO，有的文章中提到内存页、磁盘预读这些概念，这些都涉及到索引的实现原理。

为了保证数据的持久化，数据保存在磁盘上是必然的，而为了提高性能，每次又可以把部分数据读入内存来计算，然而 **访问磁盘的成本大概是访问内存的十万倍左右** 

> 以下内容引用自 美团技术博客-[MySQL索引原理及慢查询优化](https://tech.meituan.com/2014/06/30/mysql-index.html) 建议看一看

磁盘IO：磁盘读取数据靠的是机械运动，每次读取数据花费的时间可以分为 **寻道时间、旋转延迟、传输时间** 三个部分，寻道时间指的是磁臂移动到指定磁道所需要的时间，主流磁盘一般在5ms以下；旋转延迟就是我们经常听说的磁盘转速，比如一个磁盘7200转，表示每分钟能转7200次，也就是说1秒钟能转120次，旋转延迟就是1/120/2 = 4.17ms；传输时间指的是从磁盘读出或将数据写入磁盘的时间，一般在零点几毫秒，相对于前两个时间可以忽略不计，那么访问一次磁盘的时间，即一次磁盘IO的时间约等于5+4.17 = 9ms左右，数据库有千百万条数据，如果每条数据都需要


参考:[MySQL索引原理及慢查询优化](https://tech.meituan.com/2014/06/30/mysql-index.html)

### 聚集索引、普通索引、覆盖索引，最左前缀匹配原则

### 什么情况下索引会失效
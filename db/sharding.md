# 分库分表方案

为什么要分表、为什么要分库呢？

以mysql的主键索引为例，使用的是B+树，根据B+树的特点，它的叶子节点存储的是实际的数据，非叶子节点存储索引和指针，mysql将B+树的一个节点大小控制为一页大小（把BTree树的一个节点大小设计为一个存储单元即为一页（16K）），每一次IO读取的数据刚好为一页，即每次磁盘IO刚好读取B+树的一个节点内容，那么一个3层的B+树需要3次磁盘IO才能查找到对应的数据，而磁盘IO的成本是比较高的，为了有较好的性能，我们肯定也希望IO次数越少越好，所以我们以3层的B+树为例（3层及以下都有较高的性能），那么它能存储多少数据量有多少呢？

假设我们的表中一条记录大小为1K，那么B+树一个叶子节点可以存储，16K/1K=16条记录，而非叶子节点，指存储索引和指针，以主键bigint为例长度8字，指针大小为6字节，共14字节，一页大小 16K = 16384字节，所以一个非叶子节点可以存储索引数为 16384/14 = 1170 ，则一个3层的B+数可以存放 1170 * 1170 * 16 = 21902400条记录，也就是说2000万以下任意的数据量，3层的B+树都需要3次IO，性能没多大区别，如果层次越深，IO次数越多，性能也就越低。

单表的数据量2190W 是理论数据量。



参考：

https://www.cnblogs.com/leefreeman/p/8315844.html
### tcp 如何保证可靠性
大家都知道TCP是一个可靠的，既然是可靠的，就需要解决比如，包丢失了、数据被破坏了、包重复了、乱序了等等这样的问题。下面将从几个方面介绍TCP的可靠性。

**重传机制** 
TCP 实现可靠传输的方式之一，是通过序列号与确认应答，当发送端的数据到达接收主机时，接收端主机会返回一个确认应答消息，表示已收到消息，如果数据包丢失了，就会用重传机制解决。
重传机制分为超时重传、快速重传、SACK、D-SACK

- 超时重传：在发送数据时，设定一个定时器，当超过指定的时间后，没有收到对方的 ACK 确认应答报文，就会重发该数据。超时时间被称为RTO，一般略大于RTT，不过RTO是一个动态值，具体如何计算，有兴趣的可以自行查询。如果重传的包又超时了，那么再次重传时间隔为上一次代分倍数；即每当遇到一次超时重传的时候，都会将下一次超时时间间隔设为先前值的两倍。两次超时，就说明网络环境差，不宜频繁反复发送。

- 快速重传：超时重传的问题是要等超时时间后才会重传。快速重传不以时间为驱动，而是以数据驱动重传，服务器如果收到乱序的包，也给客户端回复 ACK，比如收到乱序的包 6,7,8,9 时，服务器全都发 ACK = 5，这样客户端就知道5丢失了，当客户端收到三个相同的 ACK 报文时，会在超时之前，重传丢失的报文段，而不需要等到计时器超时。

- SACK 选择性确认：快速重传只解决了超时时间的问题，假如有1~9个包要传，其中4和5丢失了，服务端收到了6~9的包后，都只给客户端响应缺少4，客户端这时有两种选择：1.重传单个包，这个时候之会重传4，再次等到三个ACK后才会重传5，这样效率就会很低；2.重传4之后的所有包，由于服务端已经收到6~9，重传一次就会造成资源的浪费。于是就有了选择性确认这种机制，这种方式需要在 TCP 头部 选项（在上一章节的TCP头部报文格式中有介绍） 字段里加一个 SACK 的选项，它可以将已收到的数据的信息发送给「发送方」，这样发送方就可以知道哪些数据收到了，哪些数据没收到，知道了这些信息，就可以只重传丢失的数据


滑动窗口、流量控制、拥塞控制



### tcp 粘包问题
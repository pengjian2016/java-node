# Nginx

### 1. 正向代理和反向代理有什么区别？

 **正向代理** 一般是代理客户端将目标服务器的内容返回给客户端，比如我们所知道的VPN软件等，客户端本身无法访问目标服务器，比如谷歌等，通过正向代理之后便可以访问。

 **反向代理** 是代理服务器端，对客户端来说是无感知的，由反向代理服务器从目标服务器上获取数据之后返回给客户端，对外暴露的是反向代理的服务器，隐藏了真实的目标服务器。

实际项目中我们一般使用Nginx做反向代理（它也可以做正向代理，只是用的比较少）。

### 2. Nginx是什么？为什么要用它？

Nginx是一个轻量级、高性能的反向代理Web服务器，可以实现负载均衡、分流等功能；

为什么要用它？首先它能实现反向代理，在实际项目中我们往往不希望将我们的应用服务器对外暴露，那么通过Nginx代理就是一个好的选择，其次，它强大的高并发、高负载能力处理也是让我们使用它的原因之一，另外它支持跨平台、配置简单、内存消耗小、成本低廉等，还有一些其他优点，比如可以将静态页面和动态api进行分离（前后端分离项目中常用）等，总之优点非常多。

### 3. Nginx的配置中location作用是什么？有优先级顺序吗？匹配的顺序是什么？

location的作用是根据用户请求的URI来执行不同的应用，也就是根据用户请求的网站URL进行匹配，匹配成功即进行相关的操作。

location分为：

正则location和普通location

正则location：以 ~、~* 开头（带星号表示不区分大小写，不带星号区分大小写）

普通location：没有任何前缀(如 location /uri )、=、^~、@ 等除了上面两种之外的所有

匹配的顺序是先匹配普通字符串，然后再匹配正则表达式。另外普通字符串匹配顺序是根据配置中字符长度从长到短，也就是说使用普通字符串配置的location顺序是无关紧要的，反正最后nginx会根据配置的长短来进行匹配，但是需要注意的是正则表达式按照配置文件里的顺序匹配。找到第一个匹配的正则表达式将停止搜索。



### 4. 假设有下面的这样例子，它的匹配顺序是什么？

示例1正则匹配：

```
location ~ /hello { # 1
    return 401;
}

location ~ /hello/test { #2
    return 402;    
}

结果：浏览器输入 http://localhost/hello/test 将返回 401；如果把1和2换一个顺序，输入同一的地址，则返回402；

```

示例2普通匹配：

```
location  /hello { # 1
    return 401;
}

location  /hello/test { #2
    return 402;    
}

结果：浏览器输入 http://localhost/hello/test 将返回 402；如果把1和2换一个顺序，输入同一的地址，同样返回402；

```

### 5. Nginx负载均衡有哪些策略？

 **轮询** ：默认策略，每个请求按时间顺序逐一分配到不同的后端服务器，如果后端某个服务器宕机，能自动剔除故障系统。

 **权重 weight** ：根据weight的权重值分配，weight值越大分配到的访问概率越高，主要用于后端每台服务器性能不均衡的情况下。其次是为在主从的情况下设置不同的权值，达到合理有效的地利用主机资源

 **ip_hash** ：根据每个请求访问时IP的哈希结果分配，使来自同一个IP的访客固定访问一台后端服务器，并且可以有效解决动态网页存在的session共享问题

其他的还有依赖第三方插件如：fair算法，需要安装upstream_fair，fair算法可以根据页面大小和加载时间长短智能地进行负载均衡，响应时间短的优先分配。

url_hash须安装Nginx的hash软件包，按访问url的hash结果来分配请求，使每个url定向到同一个后端服务器，可以进一步提高后端缓存服务器的效率


参考：

https://juejin.cn/post/6844904125784653837

https://blog.csdn.net/agonie201218/article/details/92795522
